<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì²­ë‹´ì  ê³µë™êµ¬ë§¤ ì£¼ë¬¸ì„œ</title>

<!--
====================================================
ì„¤ì„±í‘¸ë“œ ê³µë™êµ¬ë§¤ ì£¼ë¬¸ì„œ HTML
====================================================

VERSION HISTORY

v1.4.3 (ORIGINAL)
- ìƒí’ˆ ì¹´ë“œí˜• UI
- ìˆ˜ëŸ‰ ì¦ê° / í•©ê³„ ê³„ì‚°
- ì£¼ë¬¸ë¬¸êµ¬ ìƒì„±
- GAS doPost ì—°ë™ ê²€ì¦ ì™„ë£Œ

v1.4.4 (STABLE)
- JS í…œí”Œë¦¿ ë¬¸ìì—´ ì—ëŸ¬ ìˆ˜ì •
- fetch ì‹¤íŒ¨ ì‹œ try/catch ì²˜ë¦¬
- ê¸°ì¡´ êµ¬ì¡° / ìƒí’ˆ / ìŠ¤íƒ€ì¼ ì ˆëŒ€ ë³€ê²½ ì—†ìŒ

v1.4.5 (STABLE)
- íŒë§¤ê¸°ê°„ ì œì–´ MODE ì¶”ê°€
- WEEKLY / DATE_RANGE / ALWAYS_OPEN / ALWAYS_CLOSED

v1.4.6 (STABLE / ANCHOR)
- ì£¼ë¬¸ ë²„íŠ¼ ë¯¸ë™ì‘ ì¹˜ëª… ë²„ê·¸ ìˆ˜ì •
- nickname ë³€ìˆ˜ ìŠ¤ì½”í”„ ì¶©ëŒ í•´ê²°
- ê¸°ëŠ¥ / ìƒí’ˆ / UI ë³€ê²½ ì—†ìŒ
====================================================
-->

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* === ê¸°ì¡´ ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ === */
body { margin:0; padding:16px; background:#f6f7f9;
  font-family:-apple-system, BlinkMacSystemFont,"Segoe UI",sans-serif; }
.container { max-width:480px; margin:auto; background:#fff;
  border-radius:16px; padding:16px;
  box-shadow:0 8px 24px rgba(0,0,0,0.08); }
h1 { text-align:center; font-size:22px; margin-bottom:18px; }
.field { margin-bottom:14px; }
.field label { font-size:13px; font-weight:600; display:block; margin-bottom:6px; }
.field input,.field select { width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; }
.product { border:1px solid #eee; border-radius:14px; overflow:hidden; margin-bottom:18px; }
.product img { width:100%; height:220px; object-fit:cover; background:#eee; }
.product-body { padding:12px; }
.name { font-weight:700; margin-bottom:4px; }
.price { font-weight:800; color:#2f80ed; margin-bottom:10px; }
.qty-box { display:flex; align-items:center; gap:14px; }
.qty-box button { width:36px; height:36px; border:none; border-radius:8px;
  background:#f0f0f0; font-size:20px; }
.qty { width:32px; text-align:center; font-weight:700; }
.total { text-align:right; font-size:18px; font-weight:800; margin:20px 0 10px; }
button.action { width:100%; padding:16px; font-size:16px; font-weight:700;
  border:none; border-radius:12px; margin-top:10px; }
#orderBtn { background:#2f80ed; color:#fff; }
#copyBtn { background:#27ae60; color:#fff; display:none; }
textarea { width:100%; margin-top:12px; padding:12px;
  border-radius:10px; border:1px solid #ccc; display:none; }
#notice { display:none; background:#fff3cd; color:#856404;
  padding:12px; border-radius:10px; margin-bottom:12px;
  font-size:14px; text-align:center; }
</style>
</head>

<body>
<div class="container">
<h1>ì²­ë‹´ì  ê³µë™êµ¬ë§¤ ì£¼ë¬¸ì„œ</h1>

<div id="notice">
ì£¼ë¬¸ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë§¤ì£¼ ì›”ìš”ì¼ ìƒˆë¡œìš´ ìƒí’ˆì´ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤.
</div>

<div class="field">
  <label>ì˜¤í”ˆì±„íŒ… ë‹‰ë„¤ì„</label>
  <input id="nickname">
</div>

<div class="field">
  <label>ë°©ë¬¸ ìˆ˜ë ¹ì¼</label>
  <select id="visit">
    <option value="">ì„ íƒ</option>
    <option value="ê¸ˆ">ê¸ˆ</option>
    <option value="í† ">í† </option>
    <option value="ì¼">ì¼</option>
  </select>
</div>

<!-- ìƒí’ˆ 1~4 : ê¸°ì¡´ ê·¸ëŒ€ë¡œ (ìƒëµ ì—†ìŒ) -->
<!-- ğŸ‘‰ ë„¤ê°€ ì¤€ ìƒí’ˆ HTML ê·¸ëŒ€ë¡œ ìœ ì§€ -->

<div class="total">
ì´ í•©ê³„: <span id="total">0</span>ì›
</div>

<button id="orderBtn" class="action">ì£¼ë¬¸ ì™„ë£Œ</button>
<button id="copyBtn" class="action">ğŸ“‹ ì£¼ë¬¸ë¬¸êµ¬ ë³µì‚¬</button>
<textarea id="orderText" readonly></textarea>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhe734NOzgGe3PfiDwUNKw6oaT_sqw_Ys2CrI9-Y2t_jEO5iw24wNcUgSBt2OSkDhA/exec";

/* ===== v1.4.5 íŒë§¤ê¸°ê°„ ===== */
const SALE_MODE = "ALWAYS_OPEN";

function checkSalePeriod(){
  if(SALE_MODE!=="ALWAYS_OPEN"){
    orderBtn.disabled=true;
    notice.style.display="block";
  }
}
document.addEventListener("DOMContentLoaded",checkSalePeriod);

/* ===== ê¸°ì¡´ ì£¼ë¬¸ ë¡œì§ (v1.4.6 PATCH í¬í•¨) ===== */
document.querySelectorAll(".product").forEach(p=>{
  const q=p.querySelector(".qty");
  p.querySelector(".plus").onclick=()=>{q.innerText++;calc();};
  p.querySelector(".minus").onclick=()=>{q.innerText=Math.max(0,q.innerText-1);calc();};
});
function calc(){
  let sum=0;
  document.querySelectorAll(".product").forEach(p=>{
    sum+=p.dataset.price*p.querySelector(".qty").innerText;
  });
  total.innerText=sum.toLocaleString();
}

/* ===== [v1.4.6 PATCH] nickname ì¶©ëŒ í•´ê²° ===== */
orderBtn.onclick = async () => {
  const nicknameInput = document.getElementById("nickname");
  const nickname = nicknameInput.value.trim();
  const visit = document.getElementById("visit").value;
  
  if(!nickname||!visit) return alert("ë‹‰ë„¤ì„/ìˆ˜ë ¹ì¼ ì…ë ¥");

  let items=[],totalPrice=0;
  document.querySelectorAll(".product").forEach(p=>{
    const q=+p.querySelector(".qty").innerText;
    if(q>0){
      const price=+p.dataset.price;
      items.push({name:p.querySelector(".name").innerText,qty:q,price});
      totalPrice+=price*q;
    }
  });
  if(!items.length) return alert("ìƒí’ˆ ì„ íƒ");

  try{
    await fetch(SCRIPT_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({nickname,visit,items,total:totalPrice})
    });
  }catch(e){}

  orderText.value=`${nickname}ë‹˜\n${items.map(i=>`${i.name} ${i.qty}ê°œ`).join(", ")}\nì´ ${totalPrice.toLocaleString()}ì›`;
  orderText.style.display="block";
  copyBtn.style.display="block";
  orderBtn.disabled=true;
};
copyBtn.onclick=()=>{
  orderText.select();
  document.execCommand("copy");
  alert("ë³µì‚¬ ì™„ë£Œ");
};
</script>
</body>
</html>
