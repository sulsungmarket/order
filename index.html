<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì„¤ì„±ëª©ì¥ ì²­ë‹´ì  ê³µë™êµ¬ë§¤</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Apple SD Gothic Neo,sans-serif;background:#fffbe6;padding:15px}
h2{text-align:center}
.card{background:#fff;border-radius:12px;padding:12px;margin-bottom:12px}
.card img{width:100%;border-radius:10px}
.name{font-weight:bold;margin-top:8px}
.price{font-size:14px;color:#777}
.qty{display:flex;align-items:center;margin-top:8px}
.qty button{background:#ffe066;border:none;padding:6px 12px;border-radius:8px}
.qty input{width:40px;text-align:center;margin:0 8px}
.total{text-align:center;font-size:20px;font-weight:bold;margin:20px 0}
input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd;margin-bottom:12px}
button.main{width:100%;background:#fee500;border:none;padding:14px;border-radius:10px;font-size:18px;font-weight:bold}
</style>
</head>

<body>

<h2>ğŸ›’ ì„¤ì„±ëª©ì¥ ì²­ë‹´ì  ê³µë™êµ¬ë§¤</h2>

<!-- [A] ì£¼ë¬¸ì ì •ë³´ -->
<input id="nickname" placeholder="ì¹´ì¹´ì˜¤í†¡ ë‹‰ë„¤ì„">
<select id="visit">
  <option value="">ë°©ë¬¸ ìˆ˜ë ¹ì¼ ì„ íƒ</option>
  <option value="ê¸ˆ">ê¸ˆìš”ì¼</option>
  <option value="í† ">í† ìš”ì¼</option>
  <option value="ì¼">ì¼ìš”ì¼</option>
</select>

<!-- [B] ìƒí’ˆ ì˜ì—­ -->
<div id="products"></div>

<!-- [C] ì´ì•¡ -->
<div class="total">
ì´ ê²°ì œê¸ˆì•¡: <span id="total">0</span>ì›
</div>

<!-- [D] ì£¼ë¬¸ ë²„íŠ¼ -->
<button class="main" onclick="handleOrder()">ì£¼ë¬¸í•˜ê¸°</button>

<script>
/* =================================================
  Version: 1.1
  ëª©ì : ì£¼ë¬¸ ë°ì´í„° êµ¬ì¡° í™•ì •
================================================= */
/* ===== [0] êµ¬ê¸€ Apps Script URL ===== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzuoVjeg_k4fhMD3KQzHbut6w3EKlemaU2qrw7VNC5p8-HKDSPUAMRCJ96DqTh-4nQ1/exec";


/* ===== [1] ìƒí’ˆ ë°ì´í„° ===== */
const products = [
 {name:"ë–¡ì°Œë‹ˆ í•˜íŠ¸ë–¡ + ê½ƒëª¨ì–‘ ë–¡êµ­ë–¡", price:7900, img:"ë–¡ì°Œë‹ˆ.jpg"},
 {name:"ì–´ë¦°ì´ í•œìš°ìœ¡í¬ + í•œëˆìœ¡í¬", price:27900, img:"ì–´ë¦°ì´ìœ¡í¬.jpg"},
 {name:"í•œëˆ ê°„ì¥ë¶ˆê³ ê¸°", price:7900, img:"ê°„ì¥ë¶ˆê³ ê¸°.jpg"},
 {name:"í•œìš°ì‚¬ê³¨ê³°íƒ• + ë–¡êµ­ë–¡", price:9900, img:"ì‚¬ê³¨êµ­.jpg"}
];

/* ===== [2] ìƒíƒœ(State) =====
   í™”ë©´ê³¼ ë°ì´í„°ì˜ ì—°ê²° ê³ ë¦¬
*/
const state = {
  quantities: products.map(()=>0)
};

/* ===== [3] ìƒí’ˆ ë Œë” ===== */
const box = document.getElementById("products");

products.forEach((p,i)=>{
  box.innerHTML += `
    <div class="card">
      <img src="${p.img}">
      <div class="name">${p.name}</div>
      <div class="price">${p.price.toLocaleString()}ì›</div>
      <div class="qty">
        <button onclick="changeQty(${i},-1)">-</button>
        <input id="q${i}" value="0" readonly>
        <button onclick="changeQty(${i},1)">+</button>
      </div>
    </div>
  `;
});

/* ===== [4] ìˆ˜ëŸ‰ ë³€ê²½ ===== */
function changeQty(index, diff){
  state.quantities[index] = Math.max(0, state.quantities[index] + diff);
  document.getElementById("q"+index).value = state.quantities[index];
  updateTotal();
}

/* ===== [5] ì´ì•¡ ê³„ì‚° ===== */
function updateTotal(){
  let total = 0;
  products.forEach((p,i)=>{
    total += p.price * state.quantities[i];
  });
  document.getElementById("total").innerText = total.toLocaleString();
}

/* ===== [6] ì£¼ë¬¸ ì²˜ë¦¬ ===== */
/* ===== [6] ì£¼ë¬¸ ì²˜ë¦¬ (v1.2: êµ¬ê¸€ì‹œíŠ¸ ì €ì¥) ===== */
async function handleOrder(){

  /* 1. ì¤‘ë³µ ì£¼ë¬¸ ë°©ì§€ */
  if(localStorage.getItem("ordered")) return;

  /* 2. ì£¼ë¬¸ì ì •ë³´ */
  const name = document.getElementById("nickname").value;
  const visit = document.getElementById("visit").value;

  if(!name || !visit){
    alert("ë‹‰ë„¤ì„ê³¼ ë°©ë¬¸ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
    return;
  }

  /* 3. ìƒí’ˆ ëª©ë¡ êµ¬ì„± */
  const items = products
    .map((p,i)=>({
      name: p.name,
      qty: state.quantities[i],
      price: p.price
    }))
    .filter(i=>i.qty > 0);

  if(items.length === 0){
    alert("ìƒí’ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”");
    return;
  }

  /* 4. ì£¼ë¬¸ ë°ì´í„° */
  const order = {
    name,
    visit,
    items,
    total: items.reduce((s,i)=>s + i.qty * i.price, 0)
  };

  /* 5. êµ¬ê¸€ ì‹œíŠ¸ ì „ì†¡ */
  try{
    const response = await fetch(SCRIPT_URL, {
  method: "POST",
  headers: {
    "Content-Type": "application/json"
  },
  body: JSON.stringify(order)
    });

    const result = await response.json();

    if(result.result === "success"){
      alert("ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
      localStorage.setItem("ordered", "yes");
      document.body.style.pointerEvents = "none";
      document.body.style.opacity = "0.6";
    }else{
      alert("ì €ì¥ ì‹¤íŒ¨. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.");
    }

  }catch(error){
    alert("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    console.error(error);
  }
}

</script>

</body>
</html>






