<script>
/* =================================================
  Version: 1.1.3
  목적: 주문 데이터 전송 (no-cors 안정화 버전)
================================================= */

/* ===== [0] 구글 Apps Script URL ===== */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyOQBOO7JytKoWe3xiQ3CfQOfjESmSeZl4_HafvdstwgsEzFUafos4l5lOz8zGs07kS/exec";

/* ===== [6] 주문 처리 ===== */
async function handleOrder(){

  /* 1. 주문자 정보 */
  const name = document.getElementById("nickname").value;
  const visit = document.getElementById("visit").value;

  if(!name || !visit){
    alert("닉네임과 방문일을 입력해주세요");
    return;
  }

  /* 2. 상품 목록 구성 */
  const items = products
    .map((p,i)=>({
      name: p.name,
      qty: state.quantities[i],
      price: p.price
    }))
    .filter(i=>i.qty > 0);

  if(items.length === 0){
    alert("상품을 선택해주세요");
    return;
  }

  /* 3. 주문 데이터 */
  const order = {
    name,
    visit,
    items,
    total: items.reduce((s,i)=>s + i.qty * i.price, 0)
  };

  /* 4. 서버 전송 (응답 확인 안 함) */
  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(order)
    });

    alert("주문이 접수되었습니다.");

  } catch (error) {
    alert("네트워크 오류가 발생했습니다.");
    console.error(error);
  }
}
</script>
